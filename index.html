<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Attendance & Payments</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background-color: #f9f9f9; }
  h1 { text-align: center; color: #333; }
  .tabs { display: flex; cursor: pointer; margin-bottom: 10px; }
  .tab { padding: 10px 20px; background: #ddd; margin-right: 2px; border-radius: 5px 5px 0 0; }
  .tab.active { background: #4CAF50; color: white; }
  .tab-content { display: none; background: white; padding: 10px; border: 1px solid #ccc; border-radius: 0 5px 5px 5px; }
  .tab-content.active { display: block; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
  th { background-color: #4CAF50; color: white; }
  input, button { padding: 6px; margin: 5px; }
</style>
</head>
<body>

<h1>Teacher Attendance & Payments Tracker</h1>

<div class="tabs">
  <div class="tab active" onclick="openTab('attendance')">Attendance</div>
  <div class="tab" onclick="openTab('payments')">Payments</div>
</div>

<div id="attendance" class="tab-content active">
  <h2>Attendance</h2>
  <div>
    <label for="classDate">Class Date:</label>
    <input type="date" id="classDate">
    <button onclick="addAttendance()">Add Attendance</button>
  </div>
  <table id="attendanceTable">
    <thead>
      <tr>
        <th>Class Date</th>
        <th>Amount Deducted</th>
        <th>Remaining Balance</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<div id="payments" class="tab-content">
  <h2>Payments Made</h2>
  <div>
    <label for="paymentDate">Payment Date:</label>
    <input type="date" id="paymentDate">
    <label for="paymentAmount">Amount ($):</label>
    <input type="number" id="paymentAmount" value="0">
    <button onclick="addPayment()">Add Payment</button>
  </div>
  <table id="paymentTable">
    <thead>
      <tr>
        <th>Payment Date</th>
        <th>Amount Paid</th>
        <th>Total Balance</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>

<script>
/* ========= ðŸ”¥ Firebase Config =========
   Replace with YOUR Firebase project config */
const firebaseConfig = {
  apiKey: "AIzaSyDIKWRg3PAOPygzn6P6AhSE0UC2JunuAQU",
  authDomain: "katelynstutorattendance.firebaseapp.com",
  projectId: "katelynstutorattendance",
  storageBucket: "katelynstutorattendance.firebasestorage.app",
  messagingSenderId: "797372136817",
  appId: "1:797372136817:web:5b625bbda6520599918ad0",
  measurementId: "G-XBKNZM086K"

};

// Init Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ========= App Logic ========= */
let balance = 0;
const classRate = 40;

// ---------- Tab Switching ----------
function openTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  event.target.classList.add('active');
}

// ---------- Load Data from Firestore ----------
async function loadData() {
  const attendanceTable = document.querySelector('#attendanceTable tbody');
  const paymentTable = document.querySelector('#paymentTable tbody');

  attendanceTable.innerHTML = '';
  paymentTable.innerHTML = '';

  // Load attendance
  const attSnap = await db.collection("attendance").get();
  attSnap.forEach(doc => {
    const row = attendanceTable.insertRow();
    const data = doc.data();
    row.insertCell(0).textContent = data.date;
    row.insertCell(1).textContent = data.deducted;
    row.insertCell(2).textContent = data.remaining;
  });

  // Load payments
  const paySnap = await db.collection("payments").get();
  paySnap.forEach(doc => {
    const row = paymentTable.insertRow();
    const data = doc.data();
    row.insertCell(0).textContent = data.date;
    row.insertCell(1).textContent = data.amount;
    row.insertCell(2).textContent = data.total;
    balance = parseFloat(data.total.replace("$", "")); // Update balance
  });
}

// ---------- Add Payment ----------
async function addPayment() {
  const date = document.getElementById('paymentDate').value;
  const amount = parseFloat(document.getElementById('paymentAmount').value);
  if (!date || isNaN(amount) || amount <= 0) { alert('Enter valid payment info'); return; }

  balance += amount;

  await db.collection("payments").add({
    date: date,
    amount: `$${amount.toFixed(2)}`,
    total: `$${balance.toFixed(2)}`
  });

  document.getElementById('paymentDate').value = '';
  document.getElementById('paymentAmount').value = 0;

  loadData();
}

// ---------- Add Attendance ----------
async function addAttendance() {
  const date = document.getElementById('classDate').value;
  if (!date) { alert('Select a class date'); return; }

  if (balance < classRate) {
    alert('Not enough balance to cover this class. Please make a payment.');
    return;
  }

  balance -= classRate;

  await db.collection("attendance").add({
    date: date,
    deducted: `$${classRate.toFixed(2)}`,
    remaining: `$${balance.toFixed(2)}`
  });

  document.getElementById('classDate').value = '';

  loadData();
}

// Load saved data on page load
window.onload = loadData;
</script>
</body>
</html>
